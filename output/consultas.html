<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<title>Documentação de Queries SQL</title>

<style>
:root {
    --bg: #0f172a;
    --card: #020617;
    --text: #e5e7eb;
    --primary: #2563eb;
    --muted: #94a3b8;
}

body {
    background: var(--bg);
    color: var(--text);
    font-family: system-ui, -apple-system, sans-serif;
    margin: 0;
}

.container {
    max-width: 1200px;
    margin: auto;
    padding: 40px;
}

.card {
    background: var(--card);
    padding: 24px;
    border-radius: 12px;
    margin-bottom: 32px;
}

.badge {
    background: var(--primary);
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 12px;
    margin-right: 6px;
}

.meta {
    margin: 8px 0 16px;
}

.desc {
    opacity: 0.85;
}

.file {
    font-size: 14px;
    color: var(--muted);
}

pre {
    background: #020617;
    padding: 16px;
    overflow-x: auto;
    border-radius: 8px;
}

footer {
    opacity: 0.6;
    margin-top: 48px;
    font-size: 14px;
}
</style>
</head>

<body>
<div class="container">
    <h1>Documentação de Queries SQL</h1>
    <p>Documentação automática baseada em análise estrutural de consultas SQL.</p>

    
    <section class="card" id="query-1">
        <h2>1. Listagem geral de registros</h2>

        <p class="desc">Listagem de dados. utilizando as tabelas criancas_covid AS cc, criancas_faixa_etaria AS cf, tb_cidadao_vinculacao_equipe AS cve, tb_dim_equipe AS tde, tb_dim_imunobiologico AS i, tb_dim_sexo AS ds, tb_dim_tempo AS dt, tb_dim_tempo AS t, tb_dim_unidade_saude AS tdus, tb_fat_cidadao_pec AS pec, tb_fat_cidadao_territorio AS fct, tb_fat_vacinacao AS fv, tb_fat_vacinacao_vacina AS v e tb_imunobiologico AS ti.</p>

        <div class="meta">
            <span class="badge">Listagem</span>
            <span class="badge">Pesada</span>
        </div>

        <p class="file">
            <strong>Arquivo:</strong> Script-10.sql
        </p>

        
    <h4>Tabelas</h4>
    <ul>
        <li>criancas_covid AS cc</li><li>criancas_faixa_etaria AS cf</li><li>tb_cidadao_vinculacao_equipe AS cve</li><li>tb_dim_equipe AS tde</li><li>tb_dim_imunobiologico AS i</li><li>tb_dim_sexo AS ds</li><li>tb_dim_tempo AS dt</li><li>tb_dim_tempo AS t</li><li>tb_dim_unidade_saude AS tdus</li><li>tb_fat_cidadao_pec AS pec</li><li>tb_fat_cidadao_territorio AS fct</li><li>tb_fat_vacinacao AS fv</li><li>tb_fat_vacinacao_vacina AS v</li><li>tb_imunobiologico AS ti</li>
    </ul>
    
        
    <h4>Métricas</h4>
    <ul>
        <li>—</li>
    </ul>
    
        
    <h4>Dimensões</h4>
    <ul>
        <li>—</li>
    </ul>
    
        
    <h4>SQL</h4>
    <pre><code>WITH criancas_covid AS (
    SELECT DISTINCT
        pec.co_seq_fat_cidadao_pec AS co_cidadao
    FROM tb_fat_vacinacao_vacina v
        JOIN tb_fat_vacinacao fv ON v.co_fat_vacinacao = fv.co_seq_fat_vacinacao
        JOIN tb_dim_imunobiologico i ON v.co_dim_imunobiologico = i.co_seq_dim_imunobiologico
        JOIN tb_imunobiologico ti ON i.nu_identificador = ti.co_imunobiologico::text
        JOIN tb_dim_tempo t ON v.co_dim_tempo = t.co_seq_dim_tempo
        JOIN tb_fat_cidadao_pec pec ON fv.co_fat_cidadao_pec = pec.co_seq_fat_cidadao_pec
    WHERE ti.st_covid = 1
      AND EXTRACT(YEAR FROM t.dt_registro) IN (2024, 2025)
),
criancas_faixa_etaria AS (
    SELECT 
        pec.co_seq_fat_cidadao_pec,
        pec.nu_cns,
        pec.nu_cpf_cidadao,
        pec.no_cidadao,
        ds.ds_sexo,
        dt.dt_registro AS dt_nascimento,
        EXTRACT(YEAR FROM age(current_date, dt.dt_registro))::integer AS idade_anos,
        (EXTRACT(MONTH FROM age(current_date, dt.dt_registro))::integer % 12) AS idade_meses,
        tdus.nu_cnes,
        tdus.no_unidade_saude,
        tde.nu_ine,
        tde.no_equipe
    FROM tb_fat_cidadao_pec pec
        JOIN tb_fat_cidadao_territorio fct ON pec.co_seq_fat_cidadao_pec = fct.co_fat_cidadao_pec
        JOIN tb_cidadao_vinculacao_equipe cve ON pec.co_cidadao = cve.co_cidadao
        JOIN tb_dim_tempo dt ON pec.co_dim_tempo_nascimento = dt.co_seq_dim_tempo
        JOIN tb_dim_sexo ds ON pec.co_dim_sexo = ds.co_seq_dim_sexo
        JOIN tb_dim_unidade_saude tdus ON cve.nu_cnes = tdus.nu_cnes 
        JOIN tb_dim_equipe tde ON cve.nu_ine = tde.nu_ine 
    WHERE fct.st_mudou_se = 0 
      AND fct.st_vivo = 1
      AND dt.dt_registro BETWEEN &#x27;2020-01-01&#x27; AND &#x27;2024-06-30&#x27;
     
)
SELECT 
    cf.nu_cnes,
    cf.no_unidade_saude,
    cf.nu_ine,
    cf.no_equipe,
    cf.nu_cns,
    cf.nu_cpf_cidadao,
    cf.no_cidadao,
    cf.ds_sexo,
    cf.dt_nascimento,
    CASE
        WHEN cf.idade_anos &lt; 1 THEN cf.idade_meses || &#x27; mes(es)&#x27;
        WHEN cf.idade_anos = 1 THEN &#x27;1 ano e &#x27; || cf.idade_meses || &#x27; mes(es)&#x27;
        ELSE cf.idade_anos || &#x27; anos&#x27;
    END AS idade,
    &#x27;Faltoso COVID-19 (2024-2025)&#x27; AS observacao,
    current_date AS data_geracao_relatorio
FROM criancas_faixa_etaria cf
LEFT JOIN criancas_covid cc ON cf.co_seq_fat_cidadao_pec = cc.co_cidadao
WHERE cc.co_cidadao IS NULL
ORDER BY cf.no_unidade_saude, cf.nu_cnes, cf.no_equipe, cf.nu_ine, cf.no_cidadao;</code></pre>
    
    </section>
    
    <section class="card" id="query-2">
        <h2>2. Listagem geral de registros</h2>

        <p class="desc">Listagem de dados. utilizando as tabelas public.calendario_vacinal AS cv.</p>

        <div class="meta">
            <span class="badge">Listagem</span>
            <span class="badge">Simples</span>
        </div>

        <p class="file">
            <strong>Arquivo:</strong> Script-2.sql
        </p>

        
    <h4>Tabelas</h4>
    <ul>
        <li>public.calendario_vacinal AS cv</li>
    </ul>
    
        
    <h4>Métricas</h4>
    <ul>
        <li>—</li>
    </ul>
    
        
    <h4>Dimensões</h4>
    <ul>
        <li>—</li>
    </ul>
    
        
    <h4>SQL</h4>
    <pre><code>select 
    cv.no_unidade_saude as &quot;UNIDADE&quot;,
    cv.no_cidadao as &quot;CIDADÃO&quot;,
    cv.nu_cpf as &quot;CPF&quot;,
    cv.nu_cns as &quot;CNS&quot;,
    to_char(cv.dt_nascimento, &#x27;dd/MM/yyyy&#x27;) as &quot;DATA NASC&quot;,
    case
        when cv.idade_meses &lt; 12 then 
            cv.idade_meses || &#x27; mes(es)&#x27;
        else
            floor(cv.idade_meses / 12)::int || &#x27; ano(s) &#x27; || (cv.idade_meses % 12) || &#x27; mes(es)&#x27;
    end as &quot;IDADE&quot;,
    cv.no_imunobiologico as &quot;IMUNO&quot;,
    cv.no_dose_imunobiologico as &quot;DOSE&quot;
from public.calendario_vacinal cv
where cv.co_grupo_alvo = &#x27;CRIANCAS&#x27;
  and cv.co_status_vacina = &#x27;ATRASADA&#x27;
  and cv.idade_meses &lt; 12   -- apenas até 11 meses e 29 dias
order by 1,2;</code></pre>
    
    </section>
    

    <footer>
        Gerado em 21/01/2026 13:41
    </footer>
</div>
</body>
</html>
